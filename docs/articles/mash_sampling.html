<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sample from mash posteriors • mashr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sample from mash posteriors">
<meta property="og:description" content="mashr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mashr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.73</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stephenslab/mashr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sample from mash posteriors</h1>
                        <h4 data-toc-skip class="author">Yuxin Zou</h4>
            
            <h4 data-toc-skip class="date">2023-08-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stephenslab/mashr/blob/HEAD/vignettes/mash_sampling.Rmd" class="external-link"><code>vignettes/mash_sampling.Rmd</code></a></small>
      <div class="hidden name"><code>mash_sampling.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Besides the point estimates from the posteriors of
<code>mashr</code>, we also provide the option to sampling from the
posteriors. Using the samples, we can answer many questions. For
example, what proportion of effects have the same sign and similar
magnitude for each pair of conditions?</p>
<p>We use simulated data for illustration. The simulation routine
creates a dataset with 5 conditions, and four different types of effect:
null, independent among conditions, condition-specific in condition 1,
and shared (equal effects in all conditions). It creates 500 effects of
each type for a total of 2000 effects.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stephenslab/mashr" class="external-link">mashr</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co"># Loading required package: ashr</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">simdata</span> <span class="op">=</span> <span class="fu"><a href="../reference/simple_sims.html">simple_sims</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-mash-model-with-samples-from-the-posteriors">Fit mash model with samples from the posteriors<a class="anchor" aria-label="anchor" href="#fit-mash-model-with-samples-from-the-posteriors"></a>
</h2>
<p>Read in the data and set up the covariance matrices:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="../reference/mash_set_data.html">mash_set_data</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">Bhat</span>, <span class="va">simdata</span><span class="op">$</span><span class="va">Shat</span><span class="op">)</span>
<span class="va">U.c</span> <span class="op">=</span> <span class="fu"><a href="../reference/cov_canonical.html">cov_canonical</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<p>Here, we draw 100 samples from the posteriors of each effect.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="../reference/mash.html">mash</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">U.c</span>, algorithm.version <span class="op">=</span> <span class="st">'R'</span>, posterior_samples <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#  - Computing 2000 x 151 likelihood matrix.</span>
<span class="co">#  - Likelihood calculations took 0.11 seconds.</span>
<span class="co">#  - Fitting model with 151 mixture components.</span>
<span class="co">#  - Model fitting took 0.55 seconds.</span>
<span class="co">#  - Computing posterior matrices.</span>
<span class="co">#  - Computation allocated took 2.79 seconds.</span></code></pre>
<p>Using <code>get_samples(m)</code>, we have a <span class="math inline">\(2000 \times 5 \times 100\)</span> array for
samples.</p>
<p>If we fit the mash model without the posterior samples, we could use
<code>mash_compute_posterior_matrices</code> to sample from the mash
object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span><span class="op">$</span><span class="va">result</span> <span class="op">=</span> <span class="fu"><a href="../reference/mash_compute_posterior_matrices.html">mash_compute_posterior_matrices</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">data</span>, algorithm.version <span class="op">=</span> <span class="st">'R'</span>,
                                           posterior_samples <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pairwise-sharing">Pairwise sharing<a class="anchor" aria-label="anchor" href="#pairwise-sharing"></a>
</h2>
<p>To answer ‘what proportion of effects have the same sign and similar
magnitude for each pair of conditions?’, <code>mash</code> has a
function to summarize the results from samples. Here, we define similar
in magnitude to mean both the same sign and within a factor of 2 of one
another.</p>
<p><span class="math display">\[
\begin{align*}
&amp;\text{Proportion of effects have the same sign and similar
magnitude for condition r, r'} \\
&amp;= \frac{1}{2000}
\sum_{j=1}^{2000}\mathbb{E}\left(\mathbb{I}(b_{jr}, b_{jr'} \text{
have same sign and similar magnitude})  \right) \\
&amp;\approx \frac{1}{2000} \sum_{j=1}^{2000} \frac{1}{100}
\sum_{m=1}^{100} \mathbb{I}(b_{jr}^{(m)}, b_{jr'}^{(m)} \text{ have
same sign and similar magnitude})
\end{align*}
\]</span> The last approximation is achieved by sampling.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot" class="external-link">corrplot</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co"># corrplot 0.92 loaded</span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_pairwise_sharing_from_samples.html">get_pairwise_sharing_from_samples</a></span><span class="op">(</span><span class="va">m</span>, factor<span class="op">=</span><span class="fl">0.5</span>, lfsr_thresh <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="va">x</span>, method<span class="op">=</span><span class="st">'color'</span>, col.lim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, type<span class="op">=</span><span class="st">'upper'</span>, addCoef.col <span class="op">=</span> <span class="st">"black"</span>, tl.col<span class="op">=</span><span class="st">"black"</span>, tl.srt<span class="op">=</span><span class="fl">45</span>, title <span class="op">=</span> <span class="st">'Pairwise Sharing by Magnitude'</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">0</span>,<span class="fl">4</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="mash_sampling_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We can also get the proportion of <strong>significant</strong>
effects have the same sign and similar magnitude for each pair of
conditions. For each pair of conditions, first identify the effects that
are significant in at least one of the two conditions. Then compute the
probability of sharing in sign and magnitude.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_pairwise_sharing_from_samples.html">get_pairwise_sharing_from_samples</a></span><span class="op">(</span><span class="va">m</span>, factor<span class="op">=</span><span class="fl">0.5</span>, lfsr_thresh <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="va">x</span>, method<span class="op">=</span><span class="st">'color'</span>, col.lim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, type<span class="op">=</span><span class="st">'upper'</span>, addCoef.col <span class="op">=</span> <span class="st">"black"</span>, tl.col<span class="op">=</span><span class="st">"black"</span>, tl.srt<span class="op">=</span><span class="fl">45</span>, title <span class="op">=</span> <span class="st">'Pairwise Sharing by Magnitude'</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">0</span>,<span class="fl">4</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="mash_sampling_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The pairwise sharing proportions are higher, since it is computed out
of <strong>significant signals</strong> only.</p>
<p>There is another function in <code>mashr</code> package
(<code>get_pairwise_sharing</code>) that compute the proportion of
<strong>significant signals</strong> shared by magnitude in the
<strong>estimated effect sizes</strong>, for each pair of conditions.
For each pair of conditions, first identify the effects that are
significant in at least one of the two conditions. Then compute what
fraction of these have an estimated (posterior mean) effect size within
a factor <code>factor</code> of one another.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_pairwise_sharing.html">get_pairwise_sharing</a></span><span class="op">(</span><span class="va">m</span>, factor<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="va">x</span>, method<span class="op">=</span><span class="st">'color'</span>, col.lim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, type<span class="op">=</span><span class="st">'upper'</span>, addCoef.col <span class="op">=</span> <span class="st">"black"</span>, tl.col<span class="op">=</span><span class="st">"black"</span>, tl.srt<span class="op">=</span><span class="fl">45</span>, title <span class="op">=</span> <span class="st">'Pairwise Sharing by Magnitude'</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">0</span>,<span class="fl">4</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="mash_sampling_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Matthew Stephens, Sarah Urbut, Gao Wang, Yuxin Zou, Peter Carbonetto.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
